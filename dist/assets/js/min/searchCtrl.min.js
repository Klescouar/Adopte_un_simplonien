app.controller("searchCtrl",["$scope","$http","serviceApi",function(e,t,a){e.schools=a.schools,e.contrats=a.contrats,e.langages=a.langages,e.themes=a.themes,e.searchResult={maxLangage:3,maxContrat:5,Langage:[],Ville:"",Contrat:[]},t.get(a.api).then(function(t){e.data=t.data,e.cardFull=t.data},function(e){console.log("Error")});var s=function(){e.data=[];var t="undefined"!=typeof e.searchResult.Langage[0]?e.searchResult.Langage[0]:"",a="undefined"!=typeof e.searchResult.Langage[1]?e.searchResult.Langage[1]:"",s="undefined"!=typeof e.searchResult.Langage[2]?e.searchResult.Langage[2]:"",l="undefined"!=typeof e.searchResult.Ville?e.searchResult.Ville:"",i="undefined"!=typeof e.searchResult.Contrat[0]?e.searchResult.Contrat[0]:"",n="undefined"!=typeof e.searchResult.Contrat[1]?e.searchResult.Contrat[1]:"",c="undefined"!=typeof e.searchResult.Contrat[2]?e.searchResult.Contrat[2]:"",o="undefined"!=typeof e.searchResult.Contrat[3]?e.searchResult.Contrat[3]:"",r="undefined"!=typeof e.searchResult.Contrat[4]?e.searchResult.Contrat[4]:"";angular.forEach(e.cardFull,function(h,u){var f=h.contrat+" "+h.specialite1+" "+h.specialite2+" "+h.specialite3+" "+h.ville;f.match("^(?=.*"+t+")(?=.*"+a+")(?=.*"+s+")(?=.*"+l+")(?=.*"+i+")(?=.*"+n+")(?=.*"+c+")(?=.*"+o+")(?=.*"+r+")","i")&&e.data.push(h)})};s(),e.changeState=function(t){window.innerWidth>640&&(e.themes.forEach(function(e){e.active=!1}),t.active=!0),window.innerWidth<640&&t.active===!0?t.active=!1:window.innerWidth<640&&t.active===!1&&(e.themes.forEach(function(e){e.active=!1}),t.active=!0)},e.changeFilterSchool=function(){if(this.school.active===!0)this.school.active=!1,e.searchResult.Ville="";else if(0===e.searchResult.Ville.length)this.school.active=!0,e.searchResult.Ville=this.school.ville;else if(e.searchResult.Ville.length>0)for(var t=0;t<e.schools.length;t++)e.schools[t].active=!1,this.school.active=!0,e.searchResult.Ville=this.school.ville;s()},e.changeFilter=function(e,t,a){if(a.active){a.active=!1;var l=e.indexOf(a.type);l>-1&&e.splice(l,1)}else!a.active&&e.length<t&&(a.active=!0,e.push(a.type));s()},e.deleteSchoolTag=function(){for(var t=0;t<e.schools.length;t++)e.schools[t].ville===e.searchResult.Ville&&(e.schools[t].active=!1);e.searchResult.Ville="",s()},e.deleteTag=function(e,t,a){for(var l=0;l<a.length;l++)if(a[l].type===t){a[l].active=!1;var i=e.indexOf(t);i>-1&&e.splice(i,1)}s()},$(function(){var e=$(".filterMain");if(e.length){var t=e.offset().top+4;$(window).scroll(function(){$(window).scrollTop()>t&&screen.width>640?($(".filterMain").addClass("sticktotop"),$(".cardPage").addClass("marginToFix")):($(".filterMain").removeClass("sticktotop"),$(".cardPage").removeClass("marginToFix"))})}})}]);